class Room

  attr_accessor(:name, :description, :isLocked)

  def initialize(name, description, isLocked)
    @name = name
    @description = description
    @isLocked = isLocked
  end

end

class Item
  attr_accessor(:name, :description, :item_id, :canBePickedUp, :isPickedUp)

  def initialize(name, description, item_id, canBePickedUp)
    @name = name
    @description = description
    @item_id = item_id
    @canBePickedUp = canBePickedUp
    @isPickedUp = false
  end
end

# starting text that's only applied at the beginning of the game

def starting_text
  puts "You wake up in a prison cell. You have no idea how you got there."
  # pause(3)
  puts "#{current_room.description}"
  # pause(4)
  puts "There's two other cells, one opposite yours, and one next to you."
  # pause(4)
  puts "They are at the end of a prison hallway. At the other end is the exit."
  # pause(5)
  puts "There's a guard blocking the exit. He's sitting next to a desk and is asleep."
  # pause(5)
  @starting_game_text = false
end

# pause method to give the player the option to read the text 

def pause(input)
  $stdout.flush
  sleep input
end

# details about the current room the player is in

def current_room 
  @rooms[@current_room_index]
end

def current_room_items
  @current_room_items = @room_items_options[@current_room_items_index]
  @current_room_items.each_with_index do |item_name, number|
    puts "[#{number + 1}] #{item_name.name}"
  end
end

def room_items_description
  @current_room_items = @room_items_options[@current_room_items_index]
  puts "Here's what's in #{current_room.name};"
  pause(1)
  @current_room_items.each_with_index do |room_item_name, room_item_index|
    print "[#{room_item_index + 1}] #{room_item_name.name} - #{room_item_name.description}\n"
  end
end

# Player actions code

def player_move
  puts "\n"
  puts "Where would you like to move to?\n\n"
  # prints out players move options excluding the room they are in
  @rooms.each_with_index do |room, number|
    puts "[#{number + 1}] Move to #{room.name}" unless number == @current_room_index
  end
  # gets player input
  input = gets.chomp
  pause(0.5)
  # confirms if the user input is the same as the current_room_index
  if input.to_i - 1 == @current_room_index
    puts "You are already in #{current_room.name} stupid"
    pause(2)
  # checks that the input is a number in the room_id
  elsif @room_id.include?(input.to_i)
  # if so, updates the @current_room_index so the player moves
    @current_room_index = input.to_i - 1
    puts @cock
    @current_room_items_index = input.to_i - 1
  # print out message confirming that they have moved room
    puts "\nYou have moved to #{current_room.name}"
    pause(1)
    puts "#{current_room.description}"
    puts "\n"
    pause(4)
  # if user types q the game will quit
  elsif input.downcase == "q"
    @game_complete = true
  # for anything else, there's "I don't know that command"
  else
    puts "\nI don't know that command\n\n"
    pause(1)
    player_move
  end
end

def look_at
  pause(0.5)
  puts "\nWhat would you like to look at?"
  pause(1)
  puts "[I] Inventory item"
  puts "[R] Whats in the room"

  input = gets.chomp
  pause(0.5)
  if input.downcase == "i"
    inventory_description

  elsif input.downcase == "r"
    room_items_description

  elsif input.downcase == "q"
    @game_complete = true
  
  else 
    puts "I don't know that command"
    look_at
  end


end

def pick_up
  puts "here's what's in your room;"
  current_room_items
end

# players inventory

def inventory_items
  puts "\nHere are your inventory items;"
  pause(1)
    @inventory.each_with_index do |item_name, item_index|
    print "[#{item_index + 1}] #{item_name.name}\n"
  end
end

def inventory_description
   puts "Here's your inventory;"
   pause(1)
    @inventory.each_with_index do |item_name, item_index|
      print "[#{item_index + 1}] #{item_name.name} - #{item_name.description}\n"
    end
end



class Game

# code for generating items

  @mouse = Item.new("Mouse", "A cute tiny mouse. Who could be afraid of this?", 1, true)
  @desk = Item.new("Desk", "A metal desk. Flat metal top and 4 metal legs.", 2, false)
  @chair = Item.new("Chair", "A metal chair with 4 legs", 3, false)
  @bed = Item.new("Bed", "A metal bed with a thin pillow and a tatty waffer think blanket", 4, false)
  @cheese_sandwich = Item.new("Cheese_sandwich", "A mouldy cheese sandwich", 5, true)
  @prison_guard = Item.new("Prison Guard", "He's a large man, clearly been eating too many pies", 6, false)
  @prison_keys = Item.new("Prison Keys", "A bunch of keys that open all the cells and the cell room main door", 7, true)

#  generating the rooms

  @cell1 = Room.new("Your Cell", "It's a dirty room with no windows. It contains a bed, chair and desk. There's a mouse in the corner of the room", false)
  @cell2 = Room.new("Cell 2", "It's the prison cell next to yours. It's the same as yours but there's a female prison inside", false)
  @cell3 = Room.new("Cell 3", "It's the prison cell opposite yours. There's nothing in it except a bed, chair and desk", false)
  @prison_hallway = Room.new("the Prison Hallway", "At one end of the Prison Hallway is your cell and two others. At the other end sits a prison guard. The prison guard is asleep", false)

# initial game state

  @inventory = [@mouse].freeze
  @game_complete = false
  @rooms = [@cell1, @cell2, @cell3, @prison_hallway].freeze
  @current_room_index = 0
  @room_id = [1, 2, 3, 4]
  @starting_game_text = true

  @cell1_items = [@mouse, @desk, @chair, @bed]
  @cell2_items = [@desk, @chair, @bed]
  @cell3_items = [@desk, @chair, @bed, @cheese_sandwich]
  @prison_hallway_items = [@desk, @prison_guard, @prison_keys]

  @room_items_options = [@cell1_items, @cell2_items, @cell3_items, @prison_hallway_items]
  @current_room_items_index = 0
  
# Starting game

  while @game_complete == false

    # starting game text to help the player create a mental picture of the environment

    if @starting_game_text == true
      starting_text
    end

    puts "\nYou are in #{current_room.name}"
    puts "What would you like to do?"
    puts "\n"
    # pause(3)

    # print out players command options

    puts "[M] Move to"
    puts "[P] Pick up"
    puts "[L] Look at"
    puts "[I] Inventory"

    # gets user input

    input = gets.chomp

      if input.downcase == "m"
        player_move

      elsif input.downcase == "p"
        pick_up

      elsif input.downcase == "l"
        look_at

      elsif input.downcase == "i" 
        inventory_items

      elsif input.downcase == "q"
        @game_complete = true

      else
          puts "\nI don't know that command\n\n"
      end

  end

end


play = Game.new
play
